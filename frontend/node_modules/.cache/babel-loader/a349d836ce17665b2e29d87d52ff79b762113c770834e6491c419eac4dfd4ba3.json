{"ast":null,"code":"import { create } from 'zustand';\nimport axios from 'axios';\nexport const useAuth = create(set => ({\n  user: null,\n  isAuthenticated: false,\n  loading: false,\n  error: null,\n  login: async (email, password) => {\n    try {\n      set({\n        loading: true,\n        error: null\n      });\n      const response = await axios.post('http://localhost:5000/api/auth/login', {\n        email,\n        password\n      });\n      const {\n        user,\n        token\n      } = response.data;\n      // Ensure we have a valid user object with _id\n      if (!user || !user._id) {\n        throw new Error('Invalid user data received');\n      }\n      localStorage.setItem('token', token);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      set({\n        user,\n        isAuthenticated: true,\n        loading: false\n      });\n      return true;\n    } catch (error) {\n      var _error$response, _error$response$data;\n      set({\n        error: ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Login failed',\n        loading: false\n      });\n      return false;\n    }\n  },\n  logout: () => {\n    localStorage.removeItem('token');\n    delete axios.defaults.headers.common['Authorization'];\n    set({\n      user: null,\n      isAuthenticated: false\n    });\n  },\n  checkAuth: async () => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        set({\n          isAuthenticated: false\n        });\n        return;\n      }\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      const response = await axios.get('http://localhost:5000/api/auth/me');\n      set({\n        user: response.data,\n        isAuthenticated: true\n      });\n    } catch (error) {\n      localStorage.removeItem('token');\n      delete axios.defaults.headers.common['Authorization'];\n      set({\n        user: null,\n        isAuthenticated: false\n      });\n    }\n  },\n  isManager: () => {\n    var _state$user;\n    const state = useAuth.getState();\n    return ((_state$user = state.user) === null || _state$user === void 0 ? void 0 : _state$user.role) === 'manager';\n  },\n  isEngineer: () => {\n    var _state$user2;\n    const state = useAuth.getState();\n    return ((_state$user2 = state.user) === null || _state$user2 === void 0 ? void 0 : _state$user2.role) === 'engineer';\n  }\n}));","map":{"version":3,"names":["create","axios","useAuth","set","user","isAuthenticated","loading","error","login","email","password","response","post","token","data","_id","Error","localStorage","setItem","defaults","headers","common","_error$response","_error$response$data","message","logout","removeItem","checkAuth","getItem","get","isManager","_state$user","state","getState","role","isEngineer","_state$user2"],"sources":["C:/Assignment/frontend/src/store/auth.js"],"sourcesContent":["import { create } from 'zustand';\r\nimport axios from 'axios';\r\n\r\nexport const useAuth = create((set) => ({\r\n  user: null,\r\n  isAuthenticated: false,\r\n  loading: false,\r\n  error: null,\r\n\r\n  login: async (email, password) => {\r\n    try {\r\n      set({ loading: true, error: null });\r\n      const response = await axios.post('http://localhost:5000/api/auth/login', {\r\n        email,\r\n        password\r\n      });\r\n      const { user, token } = response.data;\r\n      // Ensure we have a valid user object with _id\r\n      if (!user || !user._id) {\r\n        throw new Error('Invalid user data received');\r\n      }\r\n      localStorage.setItem('token', token);\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      set({ user, isAuthenticated: true, loading: false });\r\n      return true;\r\n    } catch (error) {\r\n      set({ \r\n        error: error.response?.data?.message || 'Login failed', \r\n        loading: false \r\n      });\r\n      return false;\r\n    }\r\n  },\r\n\r\n  logout: () => {\r\n    localStorage.removeItem('token');\r\n    delete axios.defaults.headers.common['Authorization'];\r\n    set({ user: null, isAuthenticated: false });\r\n  },\r\n\r\n  checkAuth: async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        set({ isAuthenticated: false });\r\n        return;\r\n      }\r\n\r\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      const response = await axios.get('http://localhost:5000/api/auth/me');\r\n      set({ user: response.data, isAuthenticated: true });\r\n    } catch (error) {\r\n      localStorage.removeItem('token');\r\n      delete axios.defaults.headers.common['Authorization'];\r\n      set({ user: null, isAuthenticated: false });\r\n    }\r\n  },\r\n\r\n  isManager: () => {\r\n    const state = useAuth.getState();\r\n    return state.user?.role === 'manager';\r\n  },\r\n\r\n  isEngineer: () => {\r\n    const state = useAuth.getState();\r\n    return state.user?.role === 'engineer';\r\n  }\r\n}));\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}